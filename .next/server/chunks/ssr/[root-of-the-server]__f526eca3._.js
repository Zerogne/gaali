module.exports=[81769,(a,b,c)=>{b.exports=a.x("mongodb",()=>require("mongodb"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},32869,a=>{"use strict";var b=a.i(67035),c=a.i(37936),d=a.i(96256),e=a.i(53058),f=a.i(94918),g=a.i(39204);async function h(a){try{let b=f.truckLogSchema.safeParse(a);if(!b.success)throw new g.ValidationError("Invalid truck log data",b.error.issues.reduce((a,b)=>(a[b.path.join(".")]=b.message,a),{}));let c=await (0,e.getActiveCompany)(),h=await (0,d.getCompanyCollection)(c,"logs"),i={...b.data,id:`truck-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:new Date().toISOString(),sentToCustoms:!1};return await h.insertOne(i),{id:i.id,direction:i.direction,plate:i.plate,driverId:i.driverId,driverName:i.driverName,cargoType:i.cargoType,weightKg:i.weightKg,netWeightKg:i.netWeightKg,comments:i.comments,origin:i.origin,destination:i.destination,senderOrganizationId:i.senderOrganizationId,senderOrganization:i.senderOrganization,receiverOrganizationId:i.receiverOrganizationId,receiverOrganization:i.receiverOrganization,transportCompanyId:i.transportCompanyId,transportType:i.transportType,sealNumber:i.sealNumber,hasTrailer:i.hasTrailer,trailerPlate:i.trailerPlate,createdAt:i.createdAt,sentToCustoms:i.sentToCustoms}}catch(a){throw Error((0,g.handleError)(a).message)}}async function i(a){try{if(!a||"string"!=typeof a||0===a.trim().length)return{success:!1,error:"Invalid log ID"};let b=await (0,e.getActiveCompany)(),c=await (0,d.getCompanyCollection)(b,"logs");if(!await c.findOne({id:a.trim()}))return{success:!1,error:"Log not found"};if(await new Promise(a=>setTimeout(a,1e3)),.1>Math.random())return{success:!1,error:"Network error: Unable to connect to customs system"};return await c.updateOne({id:a.trim()},{$set:{sentToCustoms:!0}}),{success:!0}}catch(a){return{success:!1,error:(0,g.handleError)(a).message}}}async function j(a=1,b=50){try{let c=await (0,e.getActiveCompany)(),f=await (0,d.getCompanyCollection)(c,"logs"),g=Math.max(1,Math.floor(a)),h=Math.min(100,Math.max(1,Math.floor(b))),i=await f.countDocuments({});return{logs:(await f.find({}).sort({createdAt:-1}).skip((g-1)*h).limit(h).toArray()).map(a=>{let{_id:b,createdAt:c,...d}=a;return{...d,createdAt:"string"==typeof c?c:c instanceof Date?c.toISOString():new Date(c).toISOString()}}),total:i,page:g,limit:h,totalPages:Math.ceil(i/h)}}catch(a){throw Error((0,g.handleError)(a).message)}}async function k(a){let b=await (0,e.getActiveCompany)(),c=await (0,d.getCompanyCollection)(b,"logs"),f=await c.findOne({id:a});if(!f)return null;let{_id:g,createdAt:h,...i}=f;return{...i,createdAt:"string"==typeof h?h:h instanceof Date?h.toISOString():new Date(h).toISOString()}}async function l(a,b){try{let c=await (0,e.getActiveCompany)(),h=await (0,d.getCompanyCollection)(c,"logs"),i=await h.findOne({id:a});if(!i)return{success:!1,error:"Log not found"};if(i.sentToCustoms)return{success:!1,error:"Cannot edit logs that have been sent to customs"};if(Object.keys(b).length>0){let a=f.truckLogSchema.partial().safeParse(b);if(!a.success)throw new g.ValidationError("Invalid update data",a.error.issues.reduce((a,b)=>(a[b.path.join(".")]=b.message,a),{}))}let j={...i,...b,id:i.id,createdAt:i.createdAt,sentToCustoms:i.sentToCustoms,updatedAt:new Date().toISOString()};await h.updateOne({id:a},{$set:j});let k=await h.findOne({id:a});if(!k)return{success:!1,error:"Failed to retrieve updated log"};let l={id:k.id,direction:k.direction,plate:k.plate,driverName:k.driverName,cargoType:k.cargoType,weightKg:k.weightKg,comments:k.comments,origin:k.origin,destination:k.destination,senderOrganization:k.senderOrganization,receiverOrganization:k.receiverOrganization,sentToCustoms:k.sentToCustoms,createdAt:"string"==typeof k.createdAt?k.createdAt:k.createdAt instanceof Date?k.createdAt.toISOString():k.createdAt?new Date(k.createdAt).toISOString():new Date().toISOString()};return{success:!0,log:l}}catch(a){return{success:!1,error:(0,g.handleError)(a).message}}}(0,a.i(13095).ensureServerEntryExports)([h,i,j,k,l]),(0,c.registerServerReference)(h,"4058b122e308e364a24ba05695bd0c197e19386dfe",null),(0,c.registerServerReference)(i,"40516e7e258a23fbfc95ed115874980e9c4dedda18",null),(0,c.registerServerReference)(j,"60cd7b9c1de90cb658d4b00e637cb5c82adeca4656",null),(0,c.registerServerReference)(k,"4073ace8f60af9de407097301fd2f9db7a2077f572",null),(0,c.registerServerReference)(l,"60ba434a708325e2bf0e4dc16e4a5edf8ee1bf7c70",null),a.s([],40813),a.i(40813),a.s(["002aaa44fc4d8d053062b4a4224916d4927773c390",()=>b.logout,"40516e7e258a23fbfc95ed115874980e9c4dedda18",()=>i,"4058b122e308e364a24ba05695bd0c197e19386dfe",()=>h,"60cd7b9c1de90cb658d4b00e637cb5c82adeca4656",()=>j],32869)},36081,a=>{a.v(a=>Promise.resolve().then(()=>a(53058)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f526eca3._.js.map