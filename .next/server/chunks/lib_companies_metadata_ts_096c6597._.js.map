{"version":3,"sources":["../../../lib/companies/metadata.ts"],"sourcesContent":["\"use server\"\n\nimport { getCompaniesCollection } from \"@/lib/db/companyDb\"\n\nexport interface CompanyMetadata {\n  companyId: string\n  name: string\n  description?: string\n  logoUrl?: string\n  logoInitials?: string\n  password?: string  // Company password for authentication\n  createdAt: string | Date  // Can be Date from DB or ISO string after serialization\n  updatedAt: string | Date\n}\n\n/**\n * Get all companies (from shared companies collection)\n * Serializes MongoDB documents to plain objects for Client Components\n */\nexport async function getAllCompanies(): Promise<CompanyMetadata[]> {\n  const companiesCollection = await getCompaniesCollection()\n  const companies = await companiesCollection\n    .find({})\n    .sort({ name: 1 })\n    .toArray()\n\n  // Serialize MongoDB documents to plain objects\n  // Note: password is NOT included in serialized output for security\n  return companies.map((company: any) => {\n    const { _id, password, ...companyData } = company\n    return {\n      companyId: companyData.companyId,\n      name: companyData.name,\n      description: companyData.description,\n      logoUrl: companyData.logoUrl,\n      logoInitials: companyData.logoInitials,\n      createdAt: companyData.createdAt instanceof Date \n        ? companyData.createdAt.toISOString() \n        : (typeof companyData.createdAt === 'string' \n            ? companyData.createdAt \n            : new Date(companyData.createdAt).toISOString()),\n      updatedAt: companyData.updatedAt instanceof Date \n        ? companyData.updatedAt.toISOString() \n        : (typeof companyData.updatedAt === 'string' \n            ? companyData.updatedAt \n            : new Date(companyData.updatedAt).toISOString()),\n    }\n  }) as CompanyMetadata[]\n}\n\n/**\n * Get a single company by ID\n * Serializes MongoDB document to plain object for Client Components\n */\nexport async function getCompany(companyId: string): Promise<CompanyMetadata | null> {\n  const companiesCollection = await getCompaniesCollection()\n  const company = await companiesCollection.findOne({ companyId })\n  \n  if (!company) return null\n\n  // Serialize MongoDB document to plain object\n  // Note: password is NOT included in serialized output for security\n  const { _id, password, ...companyData } = company as any\n  return {\n    companyId: companyData.companyId,\n    name: companyData.name,\n    description: companyData.description,\n    logoUrl: companyData.logoUrl,\n    logoInitials: companyData.logoInitials,\n    createdAt: companyData.createdAt instanceof Date \n      ? companyData.createdAt.toISOString() \n      : (typeof companyData.createdAt === 'string' \n          ? companyData.createdAt \n          : new Date(companyData.createdAt).toISOString()),\n    updatedAt: companyData.updatedAt instanceof Date \n      ? companyData.updatedAt.toISOString() \n      : (typeof companyData.updatedAt === 'string' \n          ? companyData.updatedAt \n          : new Date(companyData.updatedAt).toISOString()),\n  } as CompanyMetadata\n}\n\n/**\n * Create or update company metadata\n */\nexport async function upsertCompany(company: Omit<CompanyMetadata, \"createdAt\" | \"updatedAt\">) {\n  const companiesCollection = await getCompaniesCollection()\n  \n  await companiesCollection.updateOne(\n    { companyId: company.companyId },\n    {\n      $set: {\n        ...company,\n        updatedAt: new Date(),\n      },\n      $setOnInsert: {\n        createdAt: new Date(),\n      },\n    },\n    { upsert: true }\n  )\n}\n\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OAiBO,eAAe,IACpB,IAAM,EAAsB,MAAM,CAAA,EAAA,EAAA,sBAAA,AAAsB,IAQxD,MAAO,CAPW,MAAM,EACrB,IAAI,CAAC,CAAC,GACN,IAAI,CAAC,CAAE,KAAM,CAAE,GACf,OAAO,EAAA,EAIO,GAAG,CAAC,AAAC,IACpB,GAAM,KAAE,CAAG,UAAE,CAAQ,CAAE,GAAG,EAAa,CAAG,EAC1C,MAAO,CACL,UAAW,EAAY,SAAS,CAChC,KAAM,EAAY,IAAI,CACtB,YAAa,EAAY,WAAW,CACpC,QAAS,EAAY,OAAO,CAC5B,aAAc,EAAY,YAAY,CACtC,UAAW,EAAY,SAAS,YAAY,KACxC,EAAY,SAAS,CAAC,WAAW,GACC,UAAjC,OAAO,EAAY,SAAS,CACzB,EAAY,SAAS,CACrB,IAAI,KAAK,EAAY,SAAS,EAAE,WAAW,GACnD,UAAW,EAAY,SAAS,YAAY,KACxC,EAAY,SAAS,CAAC,WAAW,GACC,UAAjC,OAAO,EAAY,SAAS,CACzB,EAAY,SAAS,CACrB,IAAI,KAAK,EAAY,SAAS,EAAE,WAAW,EACrD,CACF,EACF,CAMO,eAAe,EAAW,CAAiB,EAChD,IAAM,EAAsB,MAAM,CAAA,EAAA,EAAA,sBAAA,AAAsB,IAClD,EAAU,MAAM,EAAoB,OAAO,CAAC,CAAE,WAAU,GAE9D,GAAI,CAAC,EAAS,OAAO,KAIrB,GAAM,KAAE,CAAG,UAAE,CAAQ,CAAE,GAAG,EAAa,CAAG,EAC1C,MAAO,CACL,UAAW,EAAY,SAAS,CAChC,KAAM,EAAY,IAAI,CACtB,YAAa,EAAY,WAAW,CACpC,QAAS,EAAY,OAAO,CAC5B,aAAc,EAAY,YAAY,CACtC,UAAW,EAAY,SAAS,YAAY,KACxC,EAAY,SAAS,CAAC,WAAW,GACC,UAAjC,OAAO,EAAY,SAAS,CACzB,EAAY,SAAS,CACrB,IAAI,KAAK,EAAY,SAAS,EAAE,WAAW,GACnD,UAAW,EAAY,SAAS,YAAY,KACxC,EAAY,SAAS,CAAC,WAAW,GACC,UAAjC,OAAO,EAAY,SAAS,CACzB,EAAY,SAAS,CACrB,IAAI,KAAK,EAAY,SAAS,EAAE,WAAW,EACrD,CACF,CAKO,eAAe,EAAc,CAAyD,EAC3F,IAAM,EAAsB,MAAM,CAAA,EAAA,EAAA,sBAAA,AAAsB,GAExD,OAAM,EAAoB,SAAS,CACjC,CAAE,UAAW,EAAQ,SAAS,AAAC,EAC/B,CACE,KAAM,CACJ,GAAG,CAAO,CACV,UAAW,IAAI,IACjB,EACA,aAAc,CACZ,UAAW,IAAI,IACjB,CACF,EACA,CAAE,QAAQ,CAAK,EAEnB,0CAlFsB,EAmCA,EA+BA,IAlEA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAmCA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA+BA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}