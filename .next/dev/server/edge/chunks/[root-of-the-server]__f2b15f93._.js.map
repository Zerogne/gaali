{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport type { NextRequest } from 'next/server'\n\n/**\n * Middleware to protect routes and validate authentication\n * Redirects unauthenticated users to login page\n */\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl\n\n  // Allow public routes\n  if (\n    pathname.startsWith('/login') ||\n    pathname.startsWith('/_next') ||\n    (pathname.startsWith('/api/companies') && pathname === '/api/companies') || // Only allow GET /api/companies (no params)\n    pathname.startsWith('/api/auth') ||\n    pathname.match(/\\.(ico|png|jpg|jpeg|svg|gif|webp|css|js|woff|woff2|ttf|eot)$/)\n  ) {\n    return NextResponse.next()\n  }\n\n  // Check for authentication cookies\n  const companyId = request.cookies.get('company-id')?.value\n  const workerId = request.cookies.get('worker-id')?.value\n  const expiresAt = request.cookies.get('session-expires')?.value\n\n  // Check if session exists\n  if (!companyId || !workerId) {\n    // Redirect to login if not authenticated\n    if (pathname.startsWith('/api/')) {\n      // API routes return 401 instead of redirect\n      return NextResponse.json(\n        { error: 'Authentication required' },\n        { status: 401 }\n      )\n    }\n    return NextResponse.redirect(new URL('/login', request.url))\n  }\n\n  // Check session expiration\n  if (expiresAt) {\n    const expires = parseInt(expiresAt, 10)\n    if (!isNaN(expires) && expires < Date.now()) {\n      // Session expired\n      const response = pathname.startsWith('/api/')\n        ? NextResponse.json({ error: 'Session expired' }, { status: 401 })\n        : NextResponse.redirect(new URL('/login', request.url))\n      \n      // Clear expired cookies\n      response.cookies.delete('company-id')\n      response.cookies.delete('worker-id')\n      response.cookies.delete('session-expires')\n      \n      return response\n    }\n  }\n\n  return NextResponse.next()\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     * - public folder files (already handled above)\n     */\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAOO,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,sBAAsB;IACtB,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,aACnB,SAAS,UAAU,CAAC,qBAAqB,aAAa,oBAAqB,4CAA4C;IACxH,SAAS,UAAU,CAAC,gBACpB,SAAS,KAAK,CAAC,iEACf;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,mCAAmC;IACnC,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;IACrD,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;IACnD,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB;IAE1D,0BAA0B;IAC1B,IAAI,CAAC,aAAa,CAAC,UAAU;QAC3B,yCAAyC;QACzC,IAAI,SAAS,UAAU,CAAC,UAAU;YAChC,4CAA4C;YAC5C,OAAO,gMAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QACA,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D;IAEA,2BAA2B;IAC3B,IAAI,WAAW;QACb,MAAM,UAAU,SAAS,WAAW;QACpC,IAAI,CAAC,MAAM,YAAY,UAAU,KAAK,GAAG,IAAI;YAC3C,kBAAkB;YAClB,MAAM,WAAW,SAAS,UAAU,CAAC,WACjC,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI,KAC9D,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAEvD,wBAAwB;YACxB,SAAS,OAAO,CAAC,MAAM,CAAC;YACxB,SAAS,OAAO,CAAC,MAAM,CAAC;YACxB,SAAS,OAAO,CAAC,MAAM,CAAC;YAExB,OAAO;QACT;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;;KAMC,GACD;KACD;AACH"}}]
}